!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).crossWindowEmitter={})}(this,(function(t){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var r=function(){function t(){this.handler={}}return t.prototype.eventNames=function(){return Object.keys(this.handler)},t.prototype.listeners=function(t){return this.handler[t]||[]},t.prototype.hasListener=function(t,e){return this.listeners(t).some((function(t){return t===e}))},t.prototype.on=function(t,e){return this.handler[t]?this.hasListener(t,e)||this.handler[t].push(e):this.handler[t]=[e],this},t.prototype.off=function(t,e){return this.handler[t]&&("function"==typeof e?this.handler[t]=this.handler[t].filter((function(t){return t!==e})):delete this.handler[t]),this},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.listeners(t);return r.length>0&&(r.forEach((function(t){t.apply(void 0,e)})),!0)},t.prototype.once=function(t,e){var n=this,r=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];e.apply(void 0,o),n.off(t,r)};return this.on(t,r)},t.prototype.offAll=function(){return this.handler={},this},t}(),o={},i={getItem:function(t){return o[t]||null},setItem:function(t,e){o[t]=e},removeItem:function(t){delete o[t]}};var s=1;function a(t){return void 0===t&&(t=""),"cache2_"+("string"==typeof t&&t?t:"".concat(Math.random().toString(16).substring(2,8),"_").concat(s++))}var c=function(t){function r(e,r){var o,s,c=t.call(this)||this;return"string"==typeof e?o=e:"object"==typeof e&&(s=e),s||"object"!=typeof r||(s=r),c.options=n({max:-1,stdTTL:0,storage:i,maxStrategy:"limited",checkperiod:0,needParsed:"boolean"==typeof(null==s?void 0:s.needParsed)?s.needParsed:!!(null==s?void 0:s.storage)},s),c.options.storage===i||function(t){try{var e="object"==typeof t&&null!==t&&!!t.setItem&&!!t.getItem&&!!t.removeItem;if(e){var n=a();if(t.setItem(n,"1"),"1"!==t.getItem(n))return!1;t.removeItem(n)}return e}catch(t){return console.error("[cache2] The current custom storage is not supported. The default memory cache will be used."),!1}}(c.options.storage)||(c.options.storage=i,c.options.needParsed=!1),c.cacheKey=a(o),c.startCheckperiod(),c}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(r,t),r.prototype._check=function(t,e){var n=!0;return 0!==e.t&&e.t<Date.now()&&(n=!1,this.del(t),this.emit("expired",t,e.v)),n},r.prototype._wrap=function(t,e){var n=Date.now(),r="number"==typeof e?e:this.options.stdTTL;return{v:t,t:r>0?n+r:0,n:n}},r.prototype._isLimited=function(t){return this.options.max>-1&&t>=this.options.max},r.prototype._getReplaceKey=function(t,e){var n=t[0];return t.forEach((function(t){(e[t].t<e[n].t||e[t].t===e[n].t&&e[t].n<e[n].n)&&(n=t)})),n},r.prototype._parse=function(t){if(!this.options.needParsed)return t;try{return JSON.parse(t,this.options.reviver)}catch(e){return t}},r.prototype._stringify=function(t){return this.options.needParsed?JSON.stringify(t,this.options.replacer):t},Object.defineProperty(r.prototype,"cacheValues",{get:function(){return this._parse(this.options.storage.getItem(this.cacheKey))||{}},enumerable:!1,configurable:!0}),r.prototype.setCacheValues=function(t){this.options.storage.setItem(this.cacheKey,this._stringify(t))},r.prototype.get=function(t){var e=this.cacheValues[t];if(e&&this._check(t,e))return e.v},r.prototype.mget=function(t){var e=this,n={};if(!Array.isArray(t))return n;var r=this.cacheValues;return t.forEach((function(t){var o=r[t];o&&e._check(t,o)&&(n[t]=o.v)})),n},r.prototype.getAll=function(){var t=Object.keys(this.cacheValues);return this.mget(t)},r.prototype.set=function(t,e,n){if(0===this.options.max)return!1;var r=this.cacheValues,o=Object.keys(r);if(!r[t]&&this._isLimited(o.length)){var i=this.keys();if(this._isLimited(i.length)){if("replaced"!==this.options.maxStrategy)return!1;var s=this._getReplaceKey(i,r);this.del(s)}}return r[t]=this._wrap(e,n),this.setCacheValues(r),this.emit("set",t,r[t].v),!0},r.prototype.mset=function(t){var e=this,n=!0;return t.forEach((function(t){var r=e.set(t.key,t.value,t.ttl);n&&!r&&(n=!1)})),n},r.prototype.del=function(t){var e=this,n=this.cacheValues,r=0;return(Array.isArray(t)?t:[t]).forEach((function(t){if(n[t]){r++;var o=n[t];delete n[t],e.emit("del",t,o.v)}})),r>0&&this.setCacheValues(n),r},r.prototype.clear=function(){this.options.storage.removeItem(this.cacheKey)},r.prototype.keys=function(){var t=this,e=this.cacheValues;return Object.keys(e).filter((function(n){return t._check(n,e[n])}))},r.prototype.has=function(t){var e=this.cacheValues[t];return!(!e||!this._check(t,e))},r.prototype.take=function(t){var e,n=this.cacheValues[t];return n&&this._check(t,n)&&(e=n.v,this.del(t)),e},r.prototype.ttl=function(t,e){var n=this.cacheValues,r=n[t];return!(!r||!this._check(t,r))&&(n[t]=this._wrap(r.v,e),!0)},r.prototype.getTtl=function(t){var e=this.cacheValues,n=e[t];if(n&&this._check(t,n))return e[t].t},r.prototype.startCheckperiod=function(){var t=this;this.keys(),this.options.checkperiod>0&&(clearTimeout(this._checkTimeout),this._checkTimeout=setTimeout((function(){t.startCheckperiod()}),this.options.checkperiod))},r.prototype.stopCheckperiod=function(){clearTimeout(this._checkTimeout)},r}(r),h=18e5,u={data:{},add:function(t,e){this.data[t]||(this.data[t]=[]),this.data[t].push({timestamp:Date.now(),fn:e})},remove:function(t,e){this.data[t]&&e?this.data[t]=this.data[t].filter((function(t){return t.fn!==e})):this.data[t]=[]},get:function(t){return this.data[t]||[]},has:function(t){return this.get(t).length>0}},p=new c("__private_cross_window_emitter__",{stdTTL:h,storage:window.localStorage}),f=function(t,e){return function(){var n=p.get(t),r=u.get(t);n&&r.forEach((function(t,o){var i=t.timestamp,s=t.fn;i<n.timestamp&&(null==e||e(),r[o].timestamp=Date.now(),s.apply(null,n.params))}))}},l={data:{},start:function(t,e,n){if(void 0===n&&(n=500),t){this.data[t]||(this.data[t]={timestamp:Date.now(),pollingInterval:n,timer:null});var r=this.data[t];r.pollingInterval=n,clearInterval(r.timer),r.timer=setInterval(e,n)}},stop:function(t){t&&this.data[t]&&clearInterval(this.data[t].timer)},setPollingInterval:function(t,e){if(void 0===e&&(e=500),t&&this.data[t]&&e){e>9e5&&(console.warn("polling interval no more than ".concat(h,".")),e=9e5);var n=this.data[t];clearInterval(n.timer),this.start(t,f(t),e)}}};t.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.set(t,{timestamp:Date.now(),params:e||[]})},t.off=function(t,e){u.remove(t,e),u.has(t)||l.stop(t)},t.on=function(t,e){u.add(t,e),l.start(t,f(t))},t.once=function(t,e){var n=!1;u.add(t,e),l.start(t,(function(){n&&(u.remove(t,e),u.has(t)||l.stop(t)),f(t,(function(){n=!0}))()}))},t.setPollingInterval=function(t,e){l.setPollingInterval(t,e)}}));
//# sourceMappingURL=cross-window-emitter.min.js.map
